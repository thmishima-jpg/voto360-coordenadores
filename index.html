<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VOTO360® - Portal de Coordenadores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%); }
        .glass { backdrop-filter: blur(12px); background: rgba(255,255,255,0.95); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(0,0,0,0.15); }
        .pulse-urgent { animation: pulseUrgent 2s infinite; }
        @keyframes pulseUrgent { 0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } }
        .competencia-badge { font-size: 0.65rem; padding: 2px 8px; border-radius: 9999px; }
        .stamp { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); font-size: 3rem; font-weight: 800; opacity: 0.15; pointer-events: none; }
        .stamp-approved { color: #22c55e; }
        .stamp-rejected { color: #ef4444; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen">
    <div id="app" class="max-w-4xl mx-auto">
        <div id="login-screen" class="min-h-screen gradient-bg flex flex-col justify-center p-6">
            <div class="text-center mb-8">
                <div class="w-24 h-24 bg-white rounded-3xl mx-auto mb-6 flex items-center justify-center shadow-2xl"><i class="fas fa-shield-alt text-5xl text-slate-700"></i></div>
                <h1 class="text-4xl font-extrabold text-white tracking-tight">VOTO360®</h1>
                <p class="text-slate-300 mt-2 text-lg">Portal de Coordenadores</p>
                <p class="text-slate-400 mt-1 text-sm">Validação e Governança</p>
            </div>
            <div class="glass rounded-3xl p-8 shadow-2xl max-w-md mx-auto w-full">
                <div class="mb-5"><label class="block text-sm font-semibold text-slate-700 mb-2"><i class="fas fa-id-badge mr-2"></i>Matrícula</label><input type="text" id="matricula-input" placeholder="COORD-0001" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></div>
                <div class="mb-6"><label class="block text-sm font-semibold text-slate-700 mb-2"><i class="fas fa-key mr-2"></i>Senha</label><input type="password" id="senha-input" placeholder="••••••••" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></div>
                <button onclick="login()" class="w-full bg-slate-800 text-white py-4 rounded-xl font-bold hover:bg-slate-900 transition flex items-center justify-center space-x-2"><i class="fas fa-sign-in-alt"></i><span>Acessar Portal</span></button>
                <div class="mt-6 p-4 bg-amber-50 border border-amber-200 rounded-xl"><p class="text-xs text-amber-700"><i class="fas fa-exclamation-triangle mr-1"></i><strong>Acesso Restrito:</strong> Este portal é exclusivo para coordenadores autorizados. Todas as ações são registradas para auditoria.</p></div>
                <p class="text-center text-xs text-slate-400 mt-4">Versão 1.0.0 | VOTO360® Governança 2026</p>
            </div>
        </div>
        <div id="main-app" class="hidden min-h-screen pb-24">
            <header class="gradient-bg text-white p-4 sticky top-0 z-50 shadow-lg"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center border border-white/20"><i class="fas fa-shield-alt text-xl"></i></div><div><p class="font-bold text-lg" id="coord-name">Coordenador</p><p class="text-xs text-slate-300" id="coord-competencias">Carregando...</p></div></div><div class="flex items-center space-x-3"><div id="pending-badge" class="hidden bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold animate-pulse"><span id="pending-count">0</span> pendentes</div><button onclick="logout()" class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center border border-white/20 hover:bg-white/20 transition"><i class="fas fa-sign-out-alt"></i></button></div></div></header>
            <div class="p-4"><div class="grid grid-cols-4 gap-3"><div class="glass rounded-xl p-3 text-center card-hover"><p class="text-2xl font-bold text-amber-600" id="stat-pendentes">0</p><p class="text-xs text-slate-500">Pendentes</p></div><div class="glass rounded-xl p-3 text-center card-hover"><p class="text-2xl font-bold text-green-600" id="stat-aprovados">0</p><p class="text-xs text-slate-500">Aprovados</p></div><div class="glass rounded-xl p-3 text-center card-hover"><p class="text-2xl font-bold text-red-600" id="stat-rejeitados">0</p><p class="text-xs text-slate-500">Rejeitados</p></div><div class="glass rounded-xl p-3 text-center card-hover"><p class="text-2xl font-bold text-blue-600" id="stat-total">0</p><p class="text-xs text-slate-500">Total Hoje</p></div></div></div>
            <div class="px-4 mb-4"><div class="flex space-x-2 bg-slate-200 rounded-xl p-1"><button onclick="switchTab('pendentes')" class="tab-btn flex-1 py-2 px-4 rounded-lg text-sm font-semibold bg-white shadow" data-tab="pendentes"><i class="fas fa-clock mr-1"></i> Pendentes</button><button onclick="switchTab('historico')" class="tab-btn flex-1 py-2 px-4 rounded-lg text-sm font-semibold text-slate-600" data-tab="historico"><i class="fas fa-history mr-1"></i> Histórico</button><button onclick="switchTab('auditoria')" class="tab-btn flex-1 py-2 px-4 rounded-lg text-sm font-semibold text-slate-600" data-tab="auditoria"><i class="fas fa-search mr-1"></i> Auditoria</button></div></div>
            <div id="tab-pendentes" class="tab-content px-4"><div class="flex items-center justify-between mb-4"><h2 class="text-lg font-bold text-slate-800">Aguardando Validação</h2><button onclick="loadPendingTasks()" class="text-blue-600 text-sm"><i class="fas fa-sync-alt mr-1"></i> Atualizar</button></div><div id="pending-list" class="space-y-4"></div></div>
            <div id="tab-historico" class="tab-content hidden px-4"><div id="history-list" class="space-y-3"></div></div>
            <div id="tab-auditoria" class="tab-content hidden px-4"><div class="mb-4"><h2 class="text-lg font-bold text-slate-800 mb-3">Trilha de Auditoria</h2><div class="flex space-x-2"><input type="text" id="search-auditoria" placeholder="Buscar..." class="flex-1 px-4 py-2 border border-slate-200 rounded-xl text-sm"><button onclick="searchAuditoria()" class="bg-slate-800 text-white px-4 py-2 rounded-xl"><i class="fas fa-search"></i></button></div></div><div id="auditoria-list" class="space-y-2"></div></div>
        </div>
        <div id="validation-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4"><div class="glass rounded-3xl w-full max-w-lg max-h-[90vh] overflow-y-auto"><div class="p-6"><div class="flex items-center justify-between mb-6"><div class="flex items-center space-x-3"><div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center"><i class="fas fa-clipboard-check text-amber-600 text-xl"></i></div><div><h3 class="font-bold text-lg text-slate-800">Validar Solicitação</h3><p class="text-xs text-slate-500" id="modal-task-id">ID: ---</p></div></div><button onclick="closeModal()" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center hover:bg-slate-200 transition"><i class="fas fa-times"></i></button></div><div class="bg-slate-50 rounded-xl p-4 mb-4"><div class="mb-3"><span class="competencia-badge bg-blue-100 text-blue-700" id="modal-competencia">COMPETÊNCIA</span><span class="competencia-badge bg-slate-100 text-slate-600 ml-2" id="modal-prioridade">NORMAL</span></div><h4 class="font-semibold text-slate-800 mb-2" id="modal-titulo">Título</h4><p class="text-sm text-slate-600 mb-3" id="modal-descricao">Descrição...</p><div class="grid grid-cols-2 gap-3 text-xs"><div><p class="text-slate-400">Solicitante</p><p class="font-medium text-slate-700" id="modal-solicitante">---</p></div><div><p class="text-slate-400">Data/Hora</p><p class="font-medium text-slate-700" id="modal-data">---</p></div><div><p class="text-slate-400">Origem</p><p class="font-medium text-slate-700" id="modal-origem">---</p></div><div><p class="text-slate-400">Impacto</p><p class="font-medium text-slate-700" id="modal-impacto">---</p></div></div></div><div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4"><div class="flex items-start space-x-3"><div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"><i class="fas fa-robot text-blue-600"></i></div><div><p class="text-sm font-semibold text-blue-800">Sugestão da IA</p><p class="text-sm text-blue-700 mt-1" id="modal-ai-suggestion">Analisando...</p><p class="text-xs text-blue-500 mt-2" id="modal-ai-confidence">Confiança: ---%</p></div></div></div><div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6"><p class="text-xs text-amber-700"><i class="fas fa-gavel mr-1"></i><strong>Responsabilidade Legal:</strong> Ao validar esta solicitação, você assume responsabilidade pela decisão.</p></div><div class="mb-6"><label class="block text-sm font-semibold text-slate-700 mb-2">Justificativa <span class="text-red-500">*</span></label><textarea id="modal-justificativa" rows="3" placeholder="Descreva o motivo..." class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 resize-none"></textarea></div><div class="flex space-x-3"><button onclick="rejectTask()" class="flex-1 bg-red-500 text-white py-4 rounded-xl font-bold hover:bg-red-600 transition"><i class="fas fa-times-circle mr-2"></i>Rejeitar</button><button onclick="approveTask()" class="flex-1 bg-green-500 text-white py-4 rounded-xl font-bold hover:bg-green-600 transition"><i class="fas fa-check-circle mr-2"></i>Aprovar</button></div></div></div></div>
        <div id="toast" class="fixed top-4 left-4 right-4 max-w-md mx-auto transform -translate-y-full opacity-0 transition-all duration-300 z-50"><div class="glass rounded-xl px-4 py-3 shadow-lg border-l-4 border-green-500"><div class="flex items-center space-x-2"><i class="fas fa-check-circle text-green-500"></i><span id="toast-message" class="text-slate-700">Sucesso!</span></div></div></div>
    </div>
    <script>
        const SUPABASE_URL='https://oaqkkjkbvxdhsjgbqufd.supabase.co';const SUPABASE_ANON_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hcWtramtidnhkaHNqZ2JxdWZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkxNTY0NDMsImV4cCI6MjA4NDczMjQ0M30._Ygu8MnRge-9Hg5z3B235DHnN00eaAI1eUxvABSc5dg';const supabase=window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);const COMPETENCIAS={'FINANCEIRO':{nome:'Financeiro',cor:'bg-green-100 text-green-700',icone:'fa-dollar-sign'},'JURIDICO':{nome:'Jurídico',cor:'bg-purple-100 text-purple-700',icone:'fa-gavel'},'COMUNICACAO':{nome:'Comunicação',cor:'bg-blue-100 text-blue-700',icone:'fa-bullhorn'},'MOBILIZACAO':{nome:'Mobilização',cor:'bg-orange-100 text-orange-700',icone:'fa-users'},'LOGISTICA':{nome:'Logística',cor:'bg-cyan-100 text-cyan-700',icone:'fa-truck'},'TECNOLOGIA':{nome:'Tecnologia',cor:'bg-indigo-100 text-indigo-700',icone:'fa-laptop-code'},'RH':{nome:'Recursos Humanos',cor:'bg-pink-100 text-pink-700',icone:'fa-user-tie'},'ESTRATEGIA':{nome:'Estratégia',cor:'bg-red-100 text-red-700',icone:'fa-chess'}};let currentCoord=null;let currentTask=null;let pendingTasks=[];const DEMO_TASKS=[{id:'VAL-2026-001',titulo:'Aprovar Gasto de Campanha',descricao:'Aprovação para impressão de 50.000 santinhos.',competencia:'FINANCEIRO',prioridade:'ALTA',solicitante:'Maria Silva',origem:'App Cabo',impacto:'R$ 15.000',data:new Date(Date.now()-1800000).toISOString(),ai_suggestion:'APROVAR - Valor dentro do orçamento.',ai_confidence:92},{id:'VAL-2026-002',titulo:'Validar Cadastro de Cabo',descricao:'Cadastro de João Santos como cabo eleitoral.',competencia:'RH',prioridade:'NORMAL',solicitante:'Sistema',origem:'Portal',impacto:'1 colaborador',data:new Date(Date.now()-3600000).toISOString(),ai_suggestion:'APROVAR - Documentação OK.',ai_confidence:98},{id:'VAL-2026-003',titulo:'Autorizar Post Redes Sociais',descricao:'Post sobre proposta de saúde.',competencia:'COMUNICACAO',prioridade:'URGENTE',solicitante:'Equipe Redes',origem:'Mídias',impacto:'50.000 pessoas',data:new Date(Date.now()-900000).toISOString(),ai_suggestion:'REVISAR - Ajustar texto.',ai_confidence:78},{id:'VAL-2026-004',titulo:'Aprovar Reunião Lideranças',descricao:'Reunião com 15 líderes.',competencia:'MOBILIZACAO',prioridade:'ALTA',solicitante:'Carlos Pereira',origem:'App Reuniões',impacto:'15 líderes',data:new Date(Date.now()-7200000).toISOString(),ai_suggestion:'APROVAR - Agenda disponível.',ai_confidence:95},{id:'VAL-2026-005',titulo:'Validar Contrato Transporte',descricao:'Contrato de 5 vans.',competencia:'JURIDICO',prioridade:'ALTA',solicitante:'Jurídico',origem:'Contratos',impacto:'R$ 25.000',data:new Date(Date.now()-5400000).toISOString(),ai_suggestion:'REVISAR - Cláusula 7.2.',ai_confidence:85}];const DEMO_COORDS={'COORD-0001':{id:1,nome:'Dr. Roberto Almeida',cargo:'Coord. Geral',competencias:['FINANCEIRO','JURIDICO','RH','ESTRATEGIA'],nivel:'MASTER'},'COORD-0002':{id:2,nome:'Ana Paula Costa',cargo:'Coord. Comunicação',competencias:['COMUNICACAO'],nivel:'ESPECIALISTA'},'COORD-0003':{id:3,nome:'Marcos Oliveira',cargo:'Coord. Operações',competencias:['MOBILIZACAO','LOGISTICA'],nivel:'ESPECIALISTA'}};async function login(){const m=document.getElementById('matricula-input').value.trim().toUpperCase();const s=document.getElementById('senha-input').value;if(!m||!s){showToast('Preencha matrícula e senha','error');return;}if(DEMO_COORDS[m]){currentCoord=DEMO_COORDS[m];currentCoord.matricula=m;}else{currentCoord={id:999,nome:'Coordenador Demo',cargo:'Coord. Geral',competencias:['FINANCEIRO','JURIDICO','COMUNICACAO','MOBILIZACAO','LOGISTICA','TECNOLOGIA','RH','ESTRATEGIA'],nivel:'MASTER',matricula:m};}await registrarAuditoria('LOGIN','Acesso ao sistema',null);localStorage.setItem('voto360_coord',JSON.stringify(currentCoord));showMainApp();}function showMainApp(){document.getElementById('login-screen').classList.add('hidden');document.getElementById('main-app').classList.remove('hidden');document.getElementById('coord-name').textContent=currentCoord.nome;document.getElementById('coord-competencias').textContent=currentCoord.competencias.map(c=>COMPETENCIAS[c]?.nome||c).join(', ');loadPendingTasks();loadStats();}function logout(){registrarAuditoria('LOGOUT','Saída do sistema',null);localStorage.removeItem('voto360_coord');currentCoord=null;document.getElementById('main-app').classList.add('hidden');document.getElementById('login-screen').classList.remove('hidden');}async function loadPendingTasks(){const c=document.getElementById('pending-list');c.innerHTML='<div class="text-center py-8 text-slate-400"><i class="fas fa-spinner fa-spin text-2xl mb-2"></i><p>Carregando...</p></div>';pendingTasks=DEMO_TASKS.filter(t=>currentCoord.competencias.includes(t.competencia));const pb=document.getElementById('pending-badge');const pc=document.getElementById('pending-count');if(pendingTasks.length>0){pb.classList.remove('hidden');pc.textContent=pendingTasks.length;}else{pb.classList.add('hidden');}if(pendingTasks.length===0){c.innerHTML='<div class="text-center py-12 text-slate-400"><div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-check-double text-green-500 text-2xl"></i></div><p class="font-medium">Nenhuma tarefa pendente</p></div>';return;}c.innerHTML=pendingTasks.map(t=>{const comp=COMPETENCIAS[t.competencia];const pc=t.prioridade==='URGENTE'?'pulse-urgent border-red-300':t.prioridade==='ALTA'?'border-amber-300':'border-slate-200';const pb=t.prioridade==='URGENTE'?'bg-red-100 text-red-700':t.prioridade==='ALTA'?'bg-amber-100 text-amber-700':'bg-slate-100 text-slate-600';return'<div class="glass rounded-xl p-4 border-2 '+pc+' card-hover"><div class="flex items-start justify-between mb-3"><div class="flex items-center space-x-2"><span class="competencia-badge '+comp.cor+'"><i class="fas '+comp.icone+' mr-1"></i>'+comp.nome+'</span><span class="competencia-badge '+pb+'">'+t.prioridade+'</span></div><span class="text-xs text-slate-400">'+t.id+'</span></div><h3 class="font-semibold text-slate-800 mb-2">'+t.titulo+'</h3><p class="text-sm text-slate-600 mb-3">'+t.descricao+'</p><div class="flex items-center justify-between"><div class="text-xs text-slate-400"><i class="fas fa-clock mr-1"></i>'+formatRelativeTime(t.data)+'</div><button onclick="openValidationModal(''+t.id+'')" class="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-900"><i class="fas fa-clipboard-check mr-1"></i> Validar</button></div></div>';}).join('');}function openValidationModal(id){currentTask=pendingTasks.find(t=>t.id===id)||DEMO_TASKS.find(t=>t.id===id);if(!currentTask)return;const c=COMPETENCIAS[currentTask.competencia];document.getElementById('modal-task-id').textContent='ID: '+currentTask.id;document.getElementById('modal-competencia').textContent=c.nome;document.getElementById('modal-competencia').className='competencia-badge '+c.cor;const pb=currentTask.prioridade==='URGENTE'?'bg-red-100 text-red-700':currentTask.prioridade==='ALTA'?'bg-amber-100 text-amber-700':'bg-slate-100 text-slate-600';document.getElementById('modal-prioridade').textContent=currentTask.prioridade;document.getElementById('modal-prioridade').className='competencia-badge '+pb+' ml-2';document.getElementById('modal-titulo').textContent=currentTask.titulo;document.getElementById('modal-descricao').textContent=currentTask.descricao;document.getElementById('modal-solicitante').textContent=currentTask.solicitante;document.getElementById('modal-data').textContent=formatDateTime(currentTask.data);document.getElementById('modal-origem').textContent=currentTask.origem;document.getElementById('modal-impacto').textContent=currentTask.impacto;document.getElementById('modal-ai-suggestion').textContent=currentTask.ai_suggestion;document.getElementById('modal-ai-confidence').textContent='Confiança: '+currentTask.ai_confidence+'%';document.getElementById('modal-justificativa').value='';document.getElementById('validation-modal').classList.remove('hidden');}function closeModal(){document.getElementById('validation-modal').classList.add('hidden');currentTask=null;}async function approveTask(){const j=document.getElementById('modal-justificativa').value.trim();if(!j){showToast('Justificativa obrigatória','error');return;}await processValidation('APROVADO',j);}async function rejectTask(){const j=document.getElementById('modal-justificativa').value.trim();if(!j){showToast('Justificativa obrigatória','error');return;}await processValidation('REJEITADO',j);}async function processValidation(s,j){await registrarAuditoria(s==='APROVADO'?'APROVAR':'REJEITAR',currentTask.titulo+' - '+j,currentTask.id);try{await supabase.from('voto360_validacoes').insert([{task_id:currentTask.id,coordenador_id:currentCoord.id,coordenador_nome:currentCoord.nome,coordenador_matricula:currentCoord.matricula,competencia:currentTask.competencia,titulo:currentTask.titulo,status:s,justificativa:j,ai_suggestion:currentTask.ai_suggestion,ai_confidence:currentTask.ai_confidence,data_validacao:new Date().toISOString(),ip_address:await getIPAddress()}]);}catch(e){console.log('Demo mode');}const i=pendingTasks.findIndex(t=>t.id===currentTask.id);if(i>-1)pendingTasks.splice(i,1);const di=DEMO_TASKS.findIndex(t=>t.id===currentTask.id);if(di>-1)DEMO_TASKS.splice(di,1);closeModal();showToast(s==='APROVADO'?'Aprovado!':'Rejeitado',s==='APROVADO'?'success':'warning');loadPendingTasks();loadStats();}async function registrarAuditoria(a,d,t){const r={coordenador_id:currentCoord?.id,coordenador_nome:currentCoord?.nome,coordenador_matricula:currentCoord?.matricula,acao:a,descricao:d,task_id:t,data_hora:new Date().toISOString(),ip_address:await getIPAddress(),user_agent:navigator.userAgent};try{await supabase.from('voto360_auditoria').insert([r]);}catch(e){const al=JSON.parse(localStorage.getItem('voto360_auditoria')||'[]');al.push(r);localStorage.setItem('voto360_auditoria',JSON.stringify(al));}}async function getIPAddress(){try{const r=await fetch('https://api.ipify.org?format=json');const d=await r.json();return d.ip;}catch(e){return'N/A';}}function switchTab(n){document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));document.getElementById('tab-'+n).classList.remove('hidden');document.querySelectorAll('.tab-btn').forEach(b=>{b.classList.remove('bg-white','shadow');b.classList.add('text-slate-600');});const ab=document.querySelector('[data-tab="'+n+'"]');ab.classList.add('bg-white','shadow');ab.classList.remove('text-slate-600');if(n==='historico')loadHistory();if(n==='auditoria')loadAuditoria();}async function loadHistory(){const c=document.getElementById('history-list');const h=[{id:'VAL-2026-000',titulo:'Aprovar Banner',status:'APROVADO',data:new Date(Date.now()-86400000).toISOString(),competencia:'COMUNICACAO'},{id:'VAL-2025-999',titulo:'Contrato Gráfica',status:'APROVADO',data:new Date(Date.now()-172800000).toISOString(),competencia:'JURIDICO'},{id:'VAL-2025-998',titulo:'Evento não autorizado',status:'REJEITADO',data:new Date(Date.now()-259200000).toISOString(),competencia:'MOBILIZACAO'}];c.innerHTML=h.map(i=>{const comp=COMPETENCIAS[i.competencia];const sc=i.status==='APROVADO'?'bg-green-100 text-green-700':'bg-red-100 text-red-700';const si=i.status==='APROVADO'?'fa-check-circle':'fa-times-circle';return'<div class="glass rounded-xl p-4 relative overflow-hidden"><div class="stamp '+(i.status==='APROVADO'?'stamp-approved':'stamp-rejected')+'">'+i.status+'</div><div class="flex items-center justify-between mb-2"><span class="competencia-badge '+(comp?.cor||'bg-slate-100 text-slate-600')+'"><i class="fas '+(comp?.icone||'fa-tag')+' mr-1"></i>'+(comp?.nome||i.competencia)+'</span><span class="competencia-badge '+sc+'"><i class="fas '+si+' mr-1"></i>'+i.status+'</span></div><p class="font-medium text-slate-800">'+i.titulo+'</p><p class="text-xs text-slate-400 mt-1">'+i.id+' • '+formatDateTime(i.data)+'</p></div>';}).join('');}async function loadAuditoria(){const al=JSON.parse(localStorage.getItem('voto360_auditoria')||'[]');renderAuditoria(al.slice(-20).reverse());}function searchAuditoria(){const q=document.getElementById('search-auditoria').value.toLowerCase();const al=JSON.parse(localStorage.getItem('voto360_auditoria')||'[]');const f=al.filter(i=>i.task_id?.toLowerCase().includes(q)||i.coordenador_nome?.toLowerCase().includes(q)||i.acao?.toLowerCase().includes(q)||i.descricao?.toLowerCase().includes(q));renderAuditoria(f.reverse());}function renderAuditoria(items){const c=document.getElementById('auditoria-list');if(items.length===0){c.innerHTML='<div class="text-center py-8 text-slate-400"><i class="fas fa-clipboard-list text-2xl mb-2"></i><p>Nenhum registro</p></div>';return;}c.innerHTML=items.map(i=>{const ac=i.acao==='APROVAR'?'text-green-600':i.acao==='REJEITAR'?'text-red-600':i.acao==='LOGIN'?'text-blue-600':'text-slate-600';return'<div class="bg-white rounded-lg p-3 border border-slate-100 text-sm"><div class="flex items-center justify-between mb-1"><span class="font-semibold '+ac+'">'+i.acao+'</span><span class="text-xs text-slate-400">'+formatDateTime(i.data_hora)+'</span></div><p class="text-slate-600 text-xs">'+i.descricao+'</p><div class="flex items-center justify-between mt-2 text-xs text-slate-400"><span><i class="fas fa-user mr-1"></i>'+(i.coordenador_nome||'N/A')+'</span><span><i class="fas fa-globe mr-1"></i>'+(i.ip_address||'N/A')+'</span></div></div>';}).join('');}function loadStats(){document.getElementById('stat-pendentes').textContent=pendingTasks.length;document.getElementById('stat-aprovados').textContent=Math.floor(Math.random()*20)+10;document.getElementById('stat-rejeitados').textContent=Math.floor(Math.random()*5);document.getElementById('stat-total').textContent=Math.floor(Math.random()*30)+15;}function formatRelativeTime(d){const date=new Date(d);const now=new Date();const diff=now-date;const m=Math.floor(diff/60000);const h=Math.floor(diff/3600000);const days=Math.floor(diff/86400000);if(m<1)return'Agora';if(m<60)return'Há '+m+' min';if(h<24)return'Há '+h+'h';return'Há '+days+' dia(s)';}function formatDateTime(d){const date=new Date(d);return date.toLocaleDateString('pt-BR')+' '+date.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});}function showToast(msg,type='success'){const t=document.getElementById('toast');const tm=document.getElementById('toast-message');tm.textContent=msg;const bc={'success':'border-green-500','error':'border-red-500','warning':'border-amber-500'};t.querySelector('div').className='glass rounded-xl px-4 py-3 shadow-lg border-l-4 '+(bc[type]||bc.success);const ic={'success':'fa-check-circle text-green-500','error':'fa-exclamation-circle text-red-500','warning':'fa-exclamation-triangle text-amber-500'};t.querySelector('i').className='fas '+(ic[type]||ic.success);t.classList.remove('-translate-y-full','opacity-0');setTimeout(()=>{t.classList.add('-translate-y-full','opacity-0');},3000);}document.addEventListener('DOMContentLoaded',()=>{const s=localStorage.getItem('voto360_coord');if(s){currentCoord=JSON.parse(s);showMainApp();}});
    </script>
</body>
</html>
